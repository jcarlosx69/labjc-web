<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head><title>Panel de administración</title></head>
<body>
<div th:replace="~{layout/admin :: layout('Panel de administración','dashboard', ~{::section})}"></div>

<section class="grid gap-8">

  <!-- MÉTRICAS -->
  <section class="grid md:grid-cols-3 gap-4">
    <div class="border rounded-2xl p-4">
      <div class="text-sm text-slate-500">Visitas hoy</div>
      <div class="text-3xl font-semibold" th:text="${visitasHoy}">0</div>
    </div>
    <div class="border rounded-2xl p-4">
      <div class="text-sm text-slate-500">Visitas últimos 7 días</div>
      <div class="text-3xl font-semibold" th:text="${visitas7}">0</div>
    </div>
    <div class="border rounded-2xl p-4">
      <div class="text-sm text-slate-500">Visitas totales</div>
      <div class="text-3xl font-semibold" th:text="${visitasTotales}">0</div>
    </div>
  </section>

  <section class="grid md:grid-cols-2 gap-8">
    <div class="border rounded-2xl p-4">
      <h2 class="text-xl font-semibold mb-3">Visitas por día (7 días)</h2>
      <table class="w-full text-sm">
        <thead><tr><th class="text-left p-2">Día</th><th class="text-right p-2">Total</th></tr></thead>
        <tbody>
          <tr th:each="v : ${visitasUlt7Serie}" class="border-t">
            <td class="p-2" th:text="${v.dia}">2025-11-09</td>
            <td class="p-2 text-right" th:text="${v.total}">0</td>
          </tr>
          <tr th:if="${#lists.isEmpty(visitasUlt7Serie)}"><td colspan="2" class="p-4 text-center text-slate-500">Sin datos</td></tr>
        </tbody>
      </table>
    </div>

    <div class="border rounded-2xl p-4">
      <h2 class="text-xl font-semibold mb-3">Top rutas (7 días)</h2>
      <table class="w-full text-sm">
        <thead><tr><th class="text-left p-2">Ruta</th><th class="text-right p-2">Visitas</th></tr></thead>
        <tbody>
          <tr th:each="r : ${topRutas}" class="border-t">
            <td class="p-2" th:text="${r.ruta}">/</td>
            <td class="p-2 text-right" th:text="${r.total}">0</td>
          </tr>
          <tr th:if="${#lists.isEmpty(topRutas)}"><td colspan="2" class="p-4 text-center text-slate-500">Sin datos</td></tr>
        </tbody>
      </table>
    </div>

    <div class="border rounded-2xl p-4 md:col-span-2">
      <div class="flex items-center gap-3 mb-3">
        <h2 class="text-xl font-semibold">Descargas</h2>
        <div class="ml-auto text-sm text-slate-600">
          Acumuladas: <span class="font-semibold" th:text="${descargasAcumuladas}">0</span>
        </div>
      </div>
      <table class="w-full text-sm">
        <thead><tr><th class="text-left p-2">Nombre</th><th class="p-2">Ruta</th><th class="text-right p-2">Total</th></tr></thead>
        <tbody>
          <tr th:each="d : ${topDescargas}" class="border-t">
            <td class="p-2" th:text="${d.nombre}">Utilidad</td>
            <td class="p-2 break-all" th:text="${d.rutaArchivo}">/opt/...</td>
            <td class="p-2 text-right" th:text="${d.totalDescargas}">0</td>
          </tr>
          <tr th:if="${#lists.isEmpty(topDescargas)}"><td colspan="3" class="p-4 text-center text-slate-500">Sin descargas registradas</td></tr>
        </tbody>
      </table>
      <div class="mt-3">
        <a class="border rounded px-3 py-2" href="/admin/descargas">Gestionar descargas</a>
      </div>
    </div>
  </section>

</section>
</body>
</html>
