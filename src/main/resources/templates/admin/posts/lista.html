<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head><title>Posts</title></head>
<body>
<div th:replace="~{layout/admin :: layout('Posts','posts', ~{::section})}"></div>

<section class="grid gap-6">
  <h1 class="text-2xl font-semibold">Posts</h1>

  <div th:if="${ok}" class="p-3 rounded-xl border border-green-300 bg-green-50" th:text="${ok}"></div>
  <div th:if="${error}" class="p-3 rounded-xl border border-red-300 bg-red-50" th:text="${error}"></div>

  <div class="flex items-center gap-2">
    <form method="get" class="flex gap-2">
      <input class="border rounded p-2" type="text" name="q" placeholder="Buscar por título..." th:value="${q}"/>
      <button class="border rounded px-3 py-2">Buscar</button>
    </form>
    <a class="ml-auto border rounded px-3 py-2" href="/admin/posts/new">Nuevo</a>
  </div>

  <table class="w-full text-sm border rounded-xl overflow-hidden">
    <thead class="bg-slate-100">
      <tr>
        <th class="text-left p-2">Fecha</th>
        <th class="text-left p-2">Título</th>
        <th class="text-left p-2">Slug</th>
        <th class="text-center p-2">Publicado</th>
        <th class="p-2"></th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="p : ${lista}" class="border-t">
        <td class="p-2" th:text="${#temporals.format(p.fechaPublicacion,'yyyy-MM-dd HH:mm')}">2025-11-09</td>
        <td class="p-2" th:text="${p.titulo}">Título</td>
        <td class="p-2" th:text="${p.slug}">mi-post</td>
        <td class="p-2 text-center" th:text="${p.publicado} ? 'Sí' : 'No'">Sí</td>
        <td class="p-2 text-right">
          <a class="border rounded px-2 py-1" th:href="@{'/admin/posts/' + ${p.id} + '/edit'}">Editar</a>
          <form th:action="@{'/admin/posts/' + ${p.id} + '/delete'}" method="post" style="display:inline-block" onsubmit="return confirm('¿Eliminar?');">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button class="border rounded px-2 py-1">Borrar</button>
          </form>
        </td>
      </tr>
      <tr th:if="${#lists.isEmpty(lista)}"><td colspan="5" class="p-4 text-center text-slate-500">Sin posts</td></tr>
    </tbody>
  </table>
</section>
</body>
</html>
